<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://ch3nwe1.github.io/scaresrow/java/Collection/PriorityQueue/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>PriorityQueue - 稻草人日记</title>
        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../..">稻草人日记</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../..">主页</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">程序 <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Python</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#">基础教程</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../python/基础教程/注释/">注释</a>
</li>
            
<li >
    <a href="../../../python/基础教程/元组与列表/">元组与列表</a>
</li>
            
<li >
    <a href="../../../python/基础教程/字符串/">字符串</a>
</li>
            
<li >
    <a href="../../../python/基础教程/字典/">字典</a>
</li>
            
<li >
    <a href="../../../python/基础教程/条件控制与循环结构/">条件控制和循环结构</a>
</li>
            
<li >
    <a href="../../../python/基础教程/函数/">函数</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Java</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../String/">字符串</a>
</li>
            
<li >
    <a href="../../JUC/ReentrantLock/">ReentrantLock</a>
</li>
            
<li >
    <a href="../../JUC/Queue/">Queue</a>
</li>
            
<li >
    <a href="/java/JUC/BlockingQueue.md">Blocking</a>
</li>
            
<li >
    <a href="/java/Collection/PriorityQueue.md">PriorityQueue</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Redis</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../redis-replication Redis/redis-replication.md">None</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../about/">关于</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#priorityqueue">PriorityQueue</a></li>
            <li><a href="#_1">属性</a></li>
            <li><a href="#_2">构造器</a></li>
            <li><a href="#_3">方法介绍</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="priorityqueue">PriorityQueue</h1>
<h2 id="_1">属性</h2>
<pre><code class="java">transient Object[] queue; //集合中的容器,用于存储对象
private int size = 0; //集合中元素的数量
private final Comparator&lt;? super E&gt; comparator;// 集合中的元素比较器
transient int modCount = 0;//集合修改的次数
</code></pre>

<h2 id="_2">构造器</h2>
<pre><code class="java">public PriorityQueue() {
    // DEFAULT_INITIAL_CAPACITY = 11,数组容量
    // 比较器默认为null
    this(DEFAULT_INITIAL_CAPACITY, null);
}
//指定容器容量
public PriorityQueue(int initialCapacity) {
    this(initialCapacity, null);
}
//指定比较器
public PriorityQueue(Comparator&lt;? super E&gt; comparator) {
    this(DEFAULT_INITIAL_CAPACITY, comparator);
}
// 容量必须大于0
public PriorityQueue(int initialCapacity,
                     Comparator&lt;? super E&gt; comparator) {
    // Note: This restriction of at least one is not actually needed,
    // but continues for 1.5 compatibility
    if (initialCapacity &lt; 1)
        throw new IllegalArgumentException();
    this.queue = new Object[initialCapacity];
    this.comparator = comparator;
}
//初始化集合中的元素
public PriorityQueue(Collection&lt;? extends E&gt; c) {
    //如果是SortSet,指定相同的比较器,并初始化元素
    if (c instanceof SortedSet&lt;?&gt;) {
        SortedSet&lt;? extends E&gt; ss = (SortedSet&lt;? extends E&gt;) c;
        this.comparator = (Comparator&lt;? super E&gt;) ss.comparator();
        initElementsFromCollection(ss);
    }
    //如果是PriorityQueue,同样指定比较器并初始化集合
    else if (c instanceof PriorityQueue&lt;?&gt;) {
        PriorityQueue&lt;? extends E&gt; pq = (PriorityQueue&lt;? extends E&gt;) c;
        this.comparator = (Comparator&lt;? super E&gt;) pq.comparator();
        initFromPriorityQueue(pq);
    }
    else {
        //比较器为null
        this.comparator = null;
        //初始化集合中的元素
        initFromCollection(c);
    }
}
</code></pre>

<pre><code class="java">private void initElementsFromCollection(Collection&lt;? extends E&gt; c) {
    Object[] a = c.toArray();
    // If c.toArray incorrectly doesn't return Object[], copy it.
    //如果数组中的组件类型不是Object,拷贝元素到新数组
    if (a.getClass() != Object[].class)
        a = Arrays.copyOf(a, a.length, Object[].class);
    int len = a.length;
    //检查只有一个元素,或者比较器不为null时检查是否为空,因为空值是无法比较的
    if (len == 1 || this.comparator != null)
        for (int i = 0; i &lt; len; i++)
            if (a[i] == null)
                throw new NullPointerException();
    this.queue = a;
    this.size = a.length;
}
</code></pre>

<pre><code class="java">private void initFromPriorityQueue(PriorityQueue&lt;? extends E&gt; c) {
    //如果是PriorityQueue的Class类,而不是继承类,将容器指向其数组引用
    if (c.getClass() == PriorityQueue.class) {
        this.queue = c.toArray();
        this.size = c.size();
    } else {
        initFromCollection(c);
    }
}
</code></pre>

<pre><code class="java">private void initFromCollection(Collection&lt;? extends E&gt; c) {
    initElementsFromCollection(c);
    heapify();
}
</code></pre>

<pre><code class="java">//二叉模型构建
private void heapify() {
    for (int i = (size &gt;&gt;&gt; 1) - 1; i &gt;= 0; i--)
        siftDown(i, (E) queue[i]);
}
</code></pre>

<pre><code class="java">private void siftDown(int k, E x) {
    if (comparator != null)
        siftDownUsingComparator(k, x);
    else
        siftDownComparable(k, x);
}
</code></pre>

<pre><code class="java">private void siftDownUsingComparator(int k, E x) {
    int half = size &gt;&gt;&gt; 1;
    while (k &lt; half) {
        int child = (k &lt;&lt; 1) + 1;
        Object c = queue[child];
        int right = child + 1;
        if (right &lt; size &amp;&amp;
            comparator.compare((E) c, (E) queue[right]) &gt; 0)
            c = queue[child = right];
        if (comparator.compare(x, (E) c) &lt;= 0)
            break;
        queue[k] = c;
        k = child;
    }
    queue[k] = x;
}
</code></pre>

<h2 id="_3">方法介绍</h2>
<h3 id="offer">offer</h3>
<pre><code class="java">//向队列中添加元素
//如果为空,抛出空指针
//判断是否需要扩大队列的容量
//如果队列为空,在第一个索引处添加该元素,否则在最后插入重排序
public boolean offer(E e) {
    if (e == null)
        throw new NullPointerException();
    modCount++;
    int i = size;
    if (i &gt;= queue.length)
        grow(i + 1);
    size = i + 1;
    if (i == 0)
        queue[0] = e;
    else
        siftUp(i, e);
    return true;
}
</code></pre>

<pre><code class="java">private void siftUp(int k, E x) {
    if (comparator != null)
        siftUpUsingComparator(k, x);
    else
        siftUpComparable(k, x);
}
</code></pre>

<pre><code class="java">private void siftUpUsingComparator(int k, E x) {
    while (k &gt; 0) {
        //二叉堆父节点,如果父节点比字节点大,直接跳过,否则交换位置
        int parent = (k - 1) &gt;&gt;&gt; 1;
        Object e = queue[parent];
        if (comparator.compare(x, (E) e) &gt;= 0)
            break;
        queue[k] = e;
        k = parent;
    }
    queue[k] = x;
}
</code></pre>

<pre><code class="java">private void siftUpComparable(int k, E x) {
    //该元素需实现Comparable接口,否则会有强转异常
    //找到该父节点,比较大小,如果父节点大,直接在尾部插入该元素,如果小,则交换
    Comparable&lt;? super E&gt; key = (Comparable&lt;? super E&gt;) x;
    while (k &gt; 0) {
        int parent = (k - 1) &gt;&gt;&gt; 1;
        Object e = queue[parent];
        if (key.compareTo((E) e) &gt;= 0)
            break;
        queue[k] = e;
        k = parent;
    }
    queue[k] = key;
}
</code></pre>

<h3 id="peek">peek</h3>
<pre><code class="java">//比较简单-取堆顶元素,如果队列为空返回null
@SuppressWarnings(&quot;unchecked&quot;)
public E peek() {
    return (size == 0) ? null : (E) queue[0];
}
</code></pre>

<h3 id="poll">poll</h3>
<pre><code class="java">//获取并移除队列的第一个元素,如果队列为空返回null
@SuppressWarnings(&quot;unchecked&quot;)
public E poll() {
    if (size == 0)
        return null;
    //获取最后一个元素的索引,
    int s = --size;
    modCount++;
    E result = (E) queue[0];
    E x = (E) queue[s];
    queue[s] = null;
    //将最后一个元素添加到堆顶并调整二叉堆
    if (s != 0)
        siftDown(0, x);
    return result;
}
</code></pre>

<pre><code class="java">private void siftDown(int k, E x) {
    if (comparator != null)
        siftDownUsingComparator(k, x);
    else
        siftDownComparable(k, x);
}
</code></pre>

<pre><code class="java">//二叉堆向下调整
private void siftDownUsingComparator(int k, E x) {
    //判断是否为叶子节点,如果大于
    int half = size &gt;&gt;&gt; 1;
    while (k &lt; half) {
        int child = (k &lt;&lt; 1) + 1;
        //左子节点
        Object c = queue[child];
        int right = child + 1;
        //如果右节点不为空,去两个子节点中的最小值
        if (right &lt; size &amp;&amp;
            comparator.compare((E) c, (E) queue[right]) &gt; 0)
            c = queue[child = right];
        //当前元素与最小的子节点的元素比较
        if (comparator.compare(x, (E) c) &lt;= 0)
            break;
        //如果比子节点大,切换位置
        queue[k] = c;
        k = child;
    }
    queue[k] = x;
}
</code></pre>

<pre><code class="java">//二叉堆向下调整
@SuppressWarnings(&quot;unchecked&quot;)
private void siftDownComparable(int k, E x) {
    Comparable&lt;? super E&gt; key = (Comparable&lt;? super E&gt;)x;
    //判断是否为叶子节点
    int half = size &gt;&gt;&gt; 1;        // loop while a non-leaf
    while (k &lt; half) {
        //与两个子节点中最小的节点比较,比其大则替换
        int child = (k &lt;&lt; 1) + 1; // assume left child is least
        Object c = queue[child];
        int right = child + 1;
        if (right &lt; size &amp;&amp;
            ((Comparable&lt;? super E&gt;) c).compareTo((E) queue[right]) &gt; 0)
            c = queue[child = right];
        if (key.compareTo((E) c) &lt;= 0)
            break;
        queue[k] = c;
        k = child;
    }
    queue[k] = key;
}
</code></pre>

<h3 id="remove">remove</h3>
<pre><code class="java">//移除队列中的指定元素
//先判断是否存在,如果不存在返回false
public boolean remove(Object o) {
    int i = indexOf(o);
    if (i == -1)
        return false;
    else {
        removeAt(i);
        return true;
    }
}
</code></pre>

<pre><code class="java">private E removeAt(int i) {
    // assert i &gt;= 0 &amp;&amp; i &lt; size;
    modCount++;
    int s = --size;
    //移除的元素如果是最后一个,置为空,help GC即可
    if (s == i) // removed last element
        queue[i] = null;
    else {
        //将队列中的最后一个元素添加到移除的索引位置,然后向下调整二叉堆
        E moved = (E) queue[s];
        queue[s] = null;
        siftDown(i, moved);
        //如果没有向下调整,则向上调整
        if (queue[i] == moved) {
            siftUp(i, moved);
            if (queue[i] != moved)
                return moved;
        }
    }
    return null;
}
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
